<section class="p-5">
  <div class="event-title p-5 text-center">
    <h1><?= $event['event_name'] ?></h1>
    <input class="event-timestamp" type="hidden" value="<?= $event['event_timestamp'] ?>">
    <div class="hodziny py-4">
      <h2 class="timer-countdown"> <img src="public/images/loading.gif" alt="" height="50"> </h2>
    </div>
  </div>

<section class="navevent-wrapper py-2 w-90 mx-auto mb-5">
  <nav>
    <div class="nav nav-pills" id="nav-tab" role="tablist">
      <a class="nav-item nav-link active" data-toggle="tab" href="#nav-teams" role="tab" aria-controls="nav-home" aria-selected="true">Teams</a>
      <a class="nav-item nav-link" data-toggle="tab" href="#nav-bracket" role="tab" aria-controls="nav-profile" aria-selected="false">Bracket</a>
      <?php if ($_SESSION['user']['rootmaster'] || $_SESSION['user']['admin']): ?>
        <a class="nav-item nav-link" data-toggle="tab" href="#nav-adminpanel" role="tab" aria-controls="nav-profile" aria-selected="false">Admin</a>
      <?php endif; ?>
    </div>
  </nav>
  <div class="tab-content tab-content-profile p-5" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-teams" role="tabpanel" aria-labelledby="nav-home-tab">
      <section class="team-wrapper d-flex flex-wrap justify-content-around mb-3">
                  <?php foreach ($teams as $team): ?>
        <div class="col-6 my-2">
          <section class="each-team col-12 mx-auto p-4">
          <div>
            <p><?= $team['name'] ?></p>
            <hr style="background-color:orange;">
          </div>
          <ul>
            <?php foreach ($team['players'] as $player): ?>
              <li><?= $player ?></li>
            <?php endforeach; ?>
          </ul>
          </section>
        </div>
      <?php endforeach; ?>


      </section>
    </div>
    <div class="tab-pane fade" id="nav-bracket" role="tabpanel" aria-labelledby="nav-profile-tab">
      <?php if ($hasBrackets): ?>
        <section class="bracket-wrapper text-center d-flex flex-row justify-content-around align-items-center">
          <?php for($i = 0; $i < count($matches); $i++): ?>
            <div class="each-round col-3">
            <?php foreach ($matches[$i] as $match): ?>
              <?php if ($match['match_status'] == 'finished'): ?>
                <div class="match-finished">
              <?php endif; ?>
                  <div class="eachmatch py-2 mx-1 my-2 row justify-content-center align-items-center">
                    <?php if (($_SESSION['user']['watchman'] || $_SESSION['user']['admin'] || $_SESSION['user']['rootmaster']) && $match['match_status'] == 'live'): ?>
                      <div class="col-1" style="z-index:99;">
                      <button class="btn btn-warning btn-sm" type="button" data-toggle="modal" data-target=".modal-match-settings"><img src="https://img.icons8.com/ios-filled/32/000000/settings.png"></button>
                      </div>

                      <div class="modal modal-match-settings" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                          <div class="modal-content">
                            <div class="modal-header">
                        <h5 class="modal-title">Match settings</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body modal-message-detail-body">
                        <form method="post">
                          <div class="p-2 mx-1 my-3">
                            <label for="match-status">Match status</label>
                            <select class="form-control" name="match-status">
                              <option value="" selected>Scheduled</option>
                              <option value="">Live</option>
                              <option value="">Finished</option>
                            </select>
                          </div>

                          <button class="btn btn-primary" type="button" name="button">Submit</button>
                        </form>
                      </div>
                          </div>
                        </div>
                      </div>
                    <?php endif; ?>
                    <div class="col-7 d-flex flex-column" style="border-right:1px solid orange;">
                      <p><?php if (isset($match['match_first_team_seed'])):?><?= "(m" . $match['match_first_team_seed'] . ")"?><?php endif; ?> <?php if (isset($match['match_first_team_name'])): ?><?=$match['match_first_team_name']?> <?php endif;?><?php if (!isset($match['match_first_team_name'])): ?><?='freewin/TBD'?> <?php endif;?></p>
                      <p><?php if (isset($match['match_second_team_seed'])):?><?="(m" . $match['match_second_team_seed'] . ")"?><?php endif; ?> <?php if (!isset($match['match_second_team_name'])): ?><?='freewin/TBD'?> <?php endif;?><?php if (isset($match['match_second_team_name'])): ?><?=$match['match_second_team_name']?> <?php endif;?></p>
                    </div>
                    <div class="matchScore col-3 row justify-content-center">
                      <h2 class="col-12"><?= $match['match_first_team_score'] ?></h2>
                      <h2 class="col-12"><?= $match['match_second_team_score'] ?></h2>
                    </div>
                    <?php if ($match['match_status'] == 'finished'): ?>
                      <div class="col-1">
                        <img src="https://img.icons8.com/color/48/000000/ok.png">
                      </div>
                    <?php endif; ?>
                    <?php if (($_SESSION['user']['watchman'] || $_SESSION['user']['admin'] || $_SESSION['user']['rootmaster']) && $match['match_status'] == 'live'): ?>
                      <div class="col-1">
                        <button class="btn btn-warning" type="button" data-toggle="modal" data-target=".modal-score-write"><img src="https://img.icons8.com/windows/32/000000/-scoreboard-.png"></button>
                      </div>

                      <div class="modal modal-score-write" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                          <div class="modal-content">
                            <div class="modal-header">
                        <h5 class="modal-title">Write a score</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body modal-message-detail-body">
                        <form method="post">
                          <input type="hidden" name="match-score-write">
                          <div class="row justify-content-center p-1 m-1">
                            <h2>Team1</h2>
                            <div class="col-2">
                              <input class="form-control" type="number" name="" min="0" max="3">
                            </div>
                            <h2>:</h2>
                            <div class="col-2">
                              <input  class="form-control" type="number" name="" min="0" max="3">
                            </div>
                            <h2>Team2</h2>
                          </div>
                          <button class="btn btn-primary" type="submit" name="button">Submit</button>
                        </form>
                      </div>
                          </div>
                        </div>
                      </div>
                    <?php endif; ?>
                  </div>
                  <?php if ($match['match_status'] == 'finished'): ?>
                  </div>
                  <?php endif; ?>
            <?php endforeach; ?>
          </div>
        <?php endfor; ?>
        </section>
      <?php endif; ?>
    </div>
    <?php if ($_SESSION['user']['rootmaster'] || $_SESSION['user']['admin']): ?>
      <div class="tab-pane fade" id="nav-adminpanel" role="tabpanel" aria-labelledby="nav-profile-tab">
        <div class="accordion bg-dark" id="accordionExample">
    <div class="card">
      <div class="card-header" id="headingOne" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        <h5 class="mb-0">Settings</h5>
      </div>

      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
        <div class="card-body bg-dark">
          <form method="post">
            <input type="hidden" name="event-add">
        <div class="form-group">
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label class="input-group-text bg-warning text-dark" style="color:#FFF;" for="inputGroupSelect01">Status</label>
            </div>
            <select class="custom-select" name="eventGame">
                <option value="scheduled">Scheduled</option>
                <option value="live">Live</option>
                <option value="finished">Finished</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label class="input-group-text bg-warning mr-1 text-dark" style="color:#FFF;" for="inputGroupSelect01">Postpone (m)</label>
              <button class="btn btn-small btn-warning" type="button" name="button">+5</button><button class="btn btn-small btn-warning" type="button" name="button">+10</button><button class="btn btn-small btn-warning" type="button" name="button">+15</button><button class="btn btn-small btn-warning" type="button" name="button">+20</button>
              <button class="btn btn-small btn-warning" type="button" name="button">+25</button><button class="btn btn-small btn-warning" type="button" name="button">+30</button>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <label class="input-group-text bg-warning text-dark" style="color:#FFF;" for="inputGroupSelect01">Bracket format</label>
                <select class="custom-select" name="eventGame">
                    <option value="scheduled">Single-elimination</option>
                    <option value="live">Double-elimination</option>
                </select>
              </div>
            </div>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <label class="input-group-text bg-warning text-dark" style="color:#FFF;" for="inputGroupSelect01">Basic matches format</label>
                <select class="custom-select" name="eventGame">
                    <option value="scheduled">BO1</option>
                    <option value="live">BO3</option>
                    <option value="live">BO5</option>
                </select>
              </div>
            </div>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <label class="input-group-text bg-warning text-dark" style="color:#FFF;" for="inputGroupSelect01">Elimination matches format</label>
                <select class="custom-select" name="eventGame">
                    <option value="scheduled">BO1</option>
                    <option value="live">BO3</option>
                    <option value="live">BO5</option>
                </select>
              </div>
            </div>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <label class="input-group-text bg-warning text-dark" style="color:#FFF;" for="inputGroupSelect01">Final format</label>
                <select class="custom-select" name="eventGame">
                    <option value="scheduled">BO1</option>
                    <option value="live">BO3</option>
                    <option value="live">BO5</option>
                </select>
              </div>
            </div>
        </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Update</button>
          </form>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingTwo"  data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        <h5 class="mb-0">Bracket</h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
        <div class="card-body bg-dark">
          <span class="bg-danger p-1">Status</span>
          <hr>
          <div class="d-flex justify-content-around">
            <button class="btn btn-primary" type="button" data-toggle="modal" data-target=".generateConfirmationModal">Generate</button>
            <button class="btn btn-danger" type="button" data-toggle="modal" data-target=".dropConfirmationModal">Drop</button>
          </div>
        </div>
      </div>
    </div>

  </div>
      </div>
    <?php endif; ?>
  </div>
</section>
</section>
<div class="modal dropConfirmationModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
  <h5 class="modal-title">Are you sure you want to drop the bracket?</h5>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body modal-message-detail-body">
  <form method="post">
    <input type="hidden" name="bracket-drop">
    <input type="hidden" name="event-id" value="<?= $event['event_id']?>">
    <button class="btn btn-danger" type="submit" name="button">Yes</button>
  </form>
</div>
    </div>
  </div>
</div>

<div class="modal generateConfirmationModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
  <h5 class="modal-title">Are you sure you want to generate the bracket?</h5>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body modal-message-detail-body">
  <form method="post">
    <input type="hidden" name="bracket-generate">
    <input type="hidden" name="event-id" value="<?= $event['event_id']?>">
    <div class="row justify-content-around">
      <button class="btn btn-danger" type="submit" name="button">Yes</button>
    </div>
  </form>

</div>
    </div>
  </div>
</div>


<script>
let countDownDate = new Date(document.querySelector('.event-timestamp').value).getTime();
setInterval(function() {
  let now = new Date().getTime();
  let distance = countDownDate - now;
  let days = Math.floor(distance / (1000 * 60 * 60 * 24));
  let hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  let minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  let seconds = Math.floor((distance % (1000 * 60)) / 1000);
  let response = "<span class='bg-dark p-2'>" + days + " d : " + hours + " h : " + minutes + " m : " + seconds + " s</span>";
  document.querySelector(".timer-countdown").innerHTML = response;
  if (distance < 0) {
    clearInterval();
    document.querySelector(".timer-countdown").innerHTML = "FINISHED";
  }
}, 1000);

</script>
